<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>test_window_size — Compound Test</title>
  <link rel="stylesheet" href="common.css" />
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="left">
        <h1>test_window_size</h1>
        <p class="muted">Checks if window size is within the specified range (configurable via URL parameters).</p>
        <div class="card">
          <h2>Run Meta</h2>
          <div class="kvs" id="meta">
            <div class="k">Test</div><div class="v" data-k="name">—</div>
            <div class="k">Run ID</div><div class="v" data-k="runId">—</div>
            <div class="k">Started</div><div class="v" data-k="startedAt">—</div>
            <div class="k">Actions</div><div class="v" data-k="actions">0</div>
            <div class="k">Pass</div><div class="v" data-k="pass">0</div>
            <div class="k">Fail</div><div class="v" data-k="fail">0</div>
          </div>
          <hr />
          <div class="toolbar">
            <button class="btn" id="btn-verify">Run Assertions</button>
          </div>
          <p class="muted" style="margin-top:6px">Recommended window size: <strong>1280×960</strong>.</p>
        </div>
        <div class="card">
          <div class="big-result" id="bigResult">WAITING</div>
          <div class="list" id="cases"></div>
          <h2 style="margin-top:12px">Logs</h2>
          <pre class="log" id="log"></pre>
        </div>
      </div>
      <div class="right">
        <div class="card">
          <h2>Validation Stage</h2>
          <div id="stage" class="stage">
            <div style="font-family:monospace;font-size:14px;line-height:1.8;">
              <div><strong>Window Outer Size:</strong> <span id="outerSize">—</span></div>
              <div><strong>Window Inner Size:</strong> <span id="innerSize">—</span></div>
              <div><strong>Window Position:</strong> <span id="position">—</span></div>
              <div><strong>Screen Size:</strong> <span id="screenSize">—</span></div>
              <div><strong>Available Screen:</strong> <span id="availScreen">—</span></div>
              <div><strong>Device Pixel Ratio:</strong> <span id="dpr">—</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Fullscreen QR Overlay -->
  <div id="qrOverlay" class="qrovl" aria-hidden="true">
    <div id="qrBox" class="qrbox"></div>
    <div class="hint">QR code enlarged for reliable screenshot decoding. Click anywhere to close.</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="common.js"></script>
  <script>
  ;(() => {
    const qs = new URLSearchParams(location.search);
    const testName = 'test_window_size';
    const testManager = new window.__TestCommon({
      testName,
      runId: qs.get('run'),
      startedAt: new Date().toISOString()
    });

    // 获取参数，设置默认值
    const minWidth = parseInt(qs.get('min_width') || '1150', 10);
    const maxWidth = parseInt(qs.get('max_width') || '1280', 10);
    const minHeight = parseInt(qs.get('min_height') || '860', 10);
    const maxHeight = parseInt(qs.get('max_height') || '960', 10);

    // 更新窗口信息显示
    function updateWindowInfo() {
      document.getElementById('outerSize').textContent = `${window.outerWidth} × ${window.outerHeight}`;
      document.getElementById('innerSize').textContent = `${window.innerWidth} × ${window.innerHeight}`;
      document.getElementById('position').textContent = `(${window.screenX}, ${window.screenY})`;
      document.getElementById('screenSize').textContent = `${screen.width} × ${screen.height}`;
      document.getElementById('availScreen').textContent = `${screen.availWidth} × ${screen.availHeight}`;
      document.getElementById('dpr').textContent = window.devicePixelRatio || 1;
    }

    // 初始更新
    updateWindowInfo();

    // 监听窗口大小和位置变化
    window.addEventListener('resize', updateWindowInfo);
    window.addEventListener('move', updateWindowInfo);

    testManager.log(`Parameters: minWidth=${minWidth}, maxWidth=${maxWidth}, minHeight=${minHeight}, maxHeight=${maxHeight}`);
    testManager.log('window.outerWidth=' + window.outerWidth + ', window.outerHeight=' + window.outerHeight);

    testManager.registerAssertion(
      `window.outerWidth between ${minWidth} and ${maxWidth}`,
      { pass: true },
      async () => ({ pass: window.outerWidth >= minWidth && window.outerWidth <= maxWidth })
    );
    testManager.registerAssertion(
      `window.outerHeight between ${minHeight} and ${maxHeight}`,
      { pass: true },
      async () => ({ pass: window.outerHeight >= minHeight && window.outerHeight <= maxHeight })
    );
  })()
  </script>
</body>
</html>
