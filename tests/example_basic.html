<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Example — Click + Type</title>
  <link rel="stylesheet" href="common.css" />
  <style>
    /* example_basic.html 特有样式 */
    .stage{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}
    .target{background:#d3f9d8;border:2px solid #37b24d;letter-spacing:.5px;user-select:none}
    .target.clicked{background:#b2f2bb}
    .box{display:flex;flex-direction:column;gap:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="left">
        <h1>Example — Click + Type</h1>
        <p class="muted">This example verifies two actions from your remote runner: a click on the green target, and typing a specific string into the input box.</p>
        <div class="card">
          <h2>Run Meta</h2>
          <div class="kvs" id="meta">
            <div class="k">Test</div><div class="v" data-k="name">—</div>
            <div class="k">Run ID</div><div class="v" data-k="runId">—</div>
            <div class="k">Started</div><div class="v" data-k="startedAt">—</div>
            <div class="k">Actions</div><div class="v" data-k="actions">0</div>
            <div class="k">Pass</div><div class="v" data-k="pass">0</div>
            <div class="k">Fail</div><div class="v" data-k="fail">0</div>
          </div>
          <hr />
          <div class="toolbar">
            <button class="btn" id="btn-verify">Run Assertions</button>
          </div>
          <p class="muted" style="margin-top:6px">Expected typed string via <code>?text=hello</code> (default: "hello"). Recommended window size: <strong>1280×960</strong>.</p>
        </div>
        <div class="card">
          <div class="big-result" id="bigResult">WAITING</div>
          <div class="list" id="cases"></div>
          <h2 style="margin-top:12px">Logs</h2>
          <pre class="log" id="log"></pre>
        </div>
      </div>
      <div class="right">
        <div class="card">
          <h2>Validation Stage</h2>
          <div class="stage" id="stage">
            <div class="target" id="clickTarget" tabindex="0">CLICK ME</div>
            <div class="box">
              <label for="tbox"><strong>Type into this box</strong></label>
              <input id="tbox" type="text" placeholder="type here…" style="padding:10px;border-radius:10px;border:1px solid #94a3b8;outline:none;font-size:16px" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="qrOverlay" class="qrovl" aria-hidden="true">
    <button id="qrClose" class="close" title="Close">×</button>
    <div id="qrBox" class="qrbox"></div>
    <div class="hint">QR code enlarged for reliable screenshot decoding. Click × to close.</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="common.js"></script>
  <script>
  ;(() => {
    const qs = new URLSearchParams(location.search);
    const expectedText = qs.get('text') || 'hello';
    const testName = 'Example: click + type';
    const testManager = new window.__TestCommon({
      testName,
      runId: qs.get('run'),
      startedAt: new Date().toISOString()
    });

    const $ = sel => document.querySelector(sel);
    const clickTarget = $('#clickTarget');
    const tbox = $('#tbox');
    tbox.focus();
    clickTarget.addEventListener('click', () => {
      clickTarget.classList.add('clicked');
      testManager.log('clickTarget clicked');
    });

    testManager.registerAssertion('click target hit', {clicked:true}, async () => ({clicked: clickTarget.classList.contains('clicked')}));
    testManager.registerAssertion('typed text equals', {value: expectedText}, async () => ({value: tbox.value}));

  })()
  </script>
</body>
</html>
